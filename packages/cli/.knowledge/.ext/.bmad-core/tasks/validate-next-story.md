<!-- Powered by BMAD™ Core -->

# 验证下一个 Story 任务

## 目的

在开始实现之前全面验证 story 草稿，确保它完整、准确，并为成功开发提供足够的上下文。这个任务识别需要解决的问题和缺口，防止幻觉并确保实现就绪。

## 顺序任务执行 (当前任务完成前别继续)

### 0. 加载核心配置和输入

- 加载 `.bmad-core/core-config.yaml`
- 如果文件不存在，停下来告诉用户："找不到 core-config.yaml。这个文件是 story 验证必需的。"
- 提取关键配置：`devStoryLocation`、`prd.*`、`architecture.*`
- 识别并加载以下输入：
  - **Story 文件**：要验证的 story 草稿 (用户提供或在 `devStoryLocation` 中发现)
  - **父 epic**：包含这个 story 需求的 epic
  - **架构文档**：基于配置 (分片或单体)
  - **Story 模板**：`bmad-core/templates/story-tmpl.md` 用于完整性验证

### 1. 模板完整性验证

- 加载 `.bmad-core/templates/story-tmpl.yaml` 并从模板中提取所有章节标题
- **缺失章节检查**：把 story 章节和模板章节对比，验证所有必需章节都存在
- **占位符验证**：确保没有模板占位符没填写 (比如 `{{EpicNum}}`、`{{role}}`、`_TBD_`)
- **代理章节验证**：确认模板中的所有章节都存在，供未来代理用
- **结构合规性**：验证 story 遵循模板结构和格式

### 2. 文件结构和源码树验证

- **文件路径清晰度**：要创建/修改的新/现有文件是否明确指定？
- **源码树相关性**：Dev Notes 中是否包含相关项目结构？
- **目录结构**：新目录/组件是否根据项目结构正确定位？
- **文件创建顺序**：任务是否按逻辑顺序指定文件应该在哪里创建？
- **路径准确性**：文件路径是否与架构文档中的项目结构一致？

### 3. UI/前端完整性验证 (如果适用)

- **组件规范**：UI 组件是否足够详细以便实现？
- **样式/设计指导**：视觉实现指导是否清晰？
- **用户交互流程**：UX 模式和行为是否已指定？
- **响应式/可访问性**：如果需要，这些考虑是否已解决？
- **集成点**：前端-后端集成点是否清晰？

### 4. 验收标准满足度评估

- **AC 覆盖度**：列出的任务是否能满足所有验收标准？
- **AC 可测试性**：验收标准是否可测量和可验证？
- **缺失场景**：边界情况或错误条件是否已覆盖？
- **成功定义**：每个 AC 的"完成"是否明确定义？
- **任务-AC 映射**：任务是否正确链接到特定验收标准？

### 5. 验证和测试指令审查

- **测试方法清晰度**：测试方法是否明确指定？
- **测试场景**：关键测试用例是否已识别？
- **验证步骤**：验收标准验证步骤是否清晰？
- **测试工具/框架**：所需测试工具是否已指定？
- **测试数据需求**：测试数据需求是否已识别？

### 6. 安全考虑评估 (如果适用)

- **安全需求**：安全需求是否已识别和解决？
- **认证/授权**：访问控制是否已指定？
- **数据保护**：敏感数据处理需求是否清晰？
- **漏洞预防**：常见安全问题是否已解决？
- **合规要求**：监管/合规需求是否已解决？

### 7. 任务/子任务序列验证

- **逻辑顺序**：任务是否遵循正确的实现顺序？
- **依赖关系**：任务依赖关系是否清晰正确？
- **粒度**：任务大小是否合适且可执行？
- **完整性**：任务是否覆盖所有需求和验收标准？
- **阻塞问题**：是否有任务会阻塞其他任务？

### 8. 反幻觉验证

- **来源验证**：每个技术声明都必须可追溯到源文档
- **架构对齐**：Dev Notes 内容与架构规范匹配
- **无虚构细节**：标记任何不被源文档支持的技术决策
- **引用准确性**：验证所有源引用都正确且可访问
- **事实检查**：把声明与 epic 和架构文档交叉引用

### 9. Dev Agent 实现就绪性

- **自包含上下文**：story 是否可以在不读外部文档的情况下实现？
- **清晰指令**：实现步骤是否明确？
- **完整技术上下文**：Dev Notes 中是否包含所有必需的技术细节？
- **缺失信息**：识别任何关键信息缺口
- **可执行性**：所有任务是否对开发代理可执行？

### 10. 生成验证报告

提供结构化验证报告，包括：

#### 模板合规性问题

- story 模板中缺失的章节
- 没填写的占位符或模板变量
- 结构格式问题

#### 关键问题 (必须修复 - Story 被阻塞)

- 实现缺失的关键信息
- 不准确或不可验证的技术声明
- 验收标准覆盖不完整
- 缺失必需章节

#### 应该修复的问题 (重要质量改进)

- 实现指导不清晰
- 缺失安全考虑
- 任务排序问题
- 测试指令不完整

#### 锦上添花的改进 (可选增强)

- 有助于实现的额外上下文
- 能提高效率的澄清
- 文档改进

#### 反幻觉发现

- 不可验证的技术声明
- 缺失源引用
- 与架构文档不一致
- 虚构的库、模式或标准

#### 最终评估

- **GO**：Story 已准备好实现
- **NO-GO**：Story 在实现前需要修复
- **实现就绪评分**：1-10 分制
- **置信度**：成功实现的高/中/低置信度
